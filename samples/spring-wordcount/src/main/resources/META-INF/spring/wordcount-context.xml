<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:hdp="http://www.springframework.org/schema/hadoop"
	xmlns:p="http://www.springframework.org/schema/p"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/hadoop http://www.springframework.org/schema/hadoop/spring-hadoop.xsd">


	<bean id="runner" class="org.springframework.data.hadoop.mapreduce.JobRunner" depends-on="clean-script" p:jobs-ref="wordcount-job"/>
	
	<hdp:job id="wordcount-job"
	     input-path="${wordcount.input.path:/user/gutenberg/input/word/}"
		output-path="${wordcount.output.path:/user/gutenberg/output/word/}" 
		mapper="org.apache.hadoop.examples.WordCount.TokenizerMapper"
		reducer="org.apache.hadoop.examples.WordCount.IntSumReducer"
		configuration-ref="hadoop-configuration" validate-paths="false" />


  	   <hdp:script id="clean-script" language="groovy">
		inputPath = "${wordcount.input.path:/user/gutenberg/input/word/}"
		outputPath = "${wordcount.output.path:/user/gutenberg/output/word/}"	
		if (fsh.test(inputPath)) {
		  fsh.rmr(inputPath)
		}
		if (fsh.test(outputPath)) {
		  fsh.rmr(outputPath)
		}
		inputFile = "src/main/resources/data/nietzsche-chapter-1.txt"
		fsh.put(inputFile, inputPath)			
	  </hdp:script>	
 

</beans>
